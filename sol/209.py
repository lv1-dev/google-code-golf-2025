def p(f,o=range,l=enumerate):n={(m,e):p for m,g in l(f)for e,p in l(g)if p*(p-4)};r,g=min((m,e)for m,g in l(f)for e,p in l(g)if p==4);m,z=max((m,e)for m,g in l(f)for e,p in l(g)if p==4);m+=1-r;z+=1-g;p={(m,e):p for m in o(m)for e in o(z)if(p:=n.pop((r+m,g+e),0))};y,t=min(n);return next([[n.get((y+(m-l)//u,t+(e-v)//u),f[r+m][g+e])for e in o(z)]for m in o(m)]for u in o(2,5)for l in o(m)for v in o(z)if all(n.get((y+(m-l)//u,t+(e-v)//u))==p[m,e]for m,e in p))