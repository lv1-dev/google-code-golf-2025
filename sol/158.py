def p(i):t=range;k=len(i);a=len(i[0]);any(len({*(l:=[p[o+r][n+k]for r in t(3)for k in t(3)])})>3and l[0]^l[8]for p in(i,i[::-1])for o in t(k-2)for n in t(a-2));m=l[0],*7*(max(i[0],key=i[0].count),),l[8];[all(-1<n+k*e<a and p[o+r][n+k*e]==m[r//c*3+k//c]for r in t(3*c)for k in t(3*c))and[p[o+r].__setitem__(n+k*e,l[r//c*3+k//c])for r in t(3*c)for k in t(3*c)]for c in t(4)for o in t(k-3*c+1)for n in t(a)for p in(i,i[::-1])for e in(1,-1)];return i