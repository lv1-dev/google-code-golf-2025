def p(q):
 def p(n,f):
  if r:=len(q)>n>-1<f<len(q[n])>2<q[n][f]:q[n][f]=0;p.e+=f,~n;p.r|=p(n-1,f)+p(n,f-1)+p(n+1,f)+p(n,f+1)>2
  return r
 for n in range(len(q)):
  for f in range(len(q[n])):
   e=p.e=[];p.r=0;p(n,f);r=6-5*(len({*e})*2>len(e))-4*p.r
   while e:q[~e.pop()][e.pop()]=r
 return q